

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring the Edges &mdash; slimta 0.3.15 documentation</title>
    
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.3.15',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/cloud.js"></script>
    <link rel="top" title="slimta 0.3.15 documentation" href="../index.html" />
    <link rel="up" title="Application Usage" href="slimta.html" />
    <link rel="next" title="Configuring the Queues" href="slimta.queues.html" />
    <link rel="prev" title="Configuring the Processes" href="slimta.processes.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.queues.html" title="Configuring the Queues"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.processes.html" title="Configuring the Processes"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">slimta 0.3.15 documentation</a> &raquo;</li>

          <li><a href="../manual.html" >Usage Manual</a> &raquo;</li>
          <li><a href="slimta.html" accesskey="U">Application Usage</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuring-the-edges">
<h1>Configuring the Edges<a class="headerlink" href="#configuring-the-edges" title="Permalink to this headline">¶</a></h1>
<p>The next big section in <tt class="docutils literal"><span class="pre">slimta.conf</span></tt> is <tt class="docutils literal"><span class="pre">edge</span></tt>, which allows you to setup
as many different inbound edge listeners as you need. In the <tt class="docutils literal"><span class="pre">edge</span></tt> section,
each key provides an arbitrary, free-form name for the edge, and the value is
a mapping with two required keys:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">type</span></tt>: String</p>
<p>Defines the type of edge. A known type must be given or an error will be
thrown. The other keys in this mapping depend on the value of <tt class="docutils literal"><span class="pre">type</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">queue</span></tt>: String</p>
<p>When messages are received by this edge listener, they are passed to this
queue. The value of this queue is a name, which must correspond to a key in
the top-level <tt class="docutils literal"><span class="pre">queue</span></tt> section.</p>
</li>
</ul>
<p>When available, edges may also include a <tt class="docutils literal"><span class="pre">listener</span></tt> sub-section that uses
consistent options. This sub-section is defined as:</p>
<ul id="slimta-listener">
<li><p class="first"><tt class="docutils literal"><span class="pre">listener</span></tt>: Dictionary</p>
<p>This mapping defines how to open the listening socket. Available keys are as
follows:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">type</span></tt>: String</p>
<p>Defines the type of listening socket. Valid values are <tt class="docutils literal"><span class="pre">tcp</span></tt> , <tt class="docutils literal"><span class="pre">udp</span></tt>
and <tt class="docutils literal"><span class="pre">unix</span></tt>. The default type is <tt class="docutils literal"><span class="pre">tcp</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">interface</span></tt>: String</p>
<p>For <tt class="docutils literal"><span class="pre">tcp</span></tt> and <tt class="docutils literal"><span class="pre">udp</span></tt> types, this setting defines the interface IP on
which to bind. Examples are <tt class="docutils literal"><span class="pre">'127.0.0.1'</span></tt> to only listen locally, or
<tt class="docutils literal"><span class="pre">''</span></tt> to listen on all interfaces. The default is <tt class="docutils literal"><span class="pre">'127.0.0.1'</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">port</span></tt>: Integer</p>
<p>For <tt class="docutils literal"><span class="pre">tcp</span></tt> and <tt class="docutils literal"><span class="pre">udp</span></tt> types, this setting defines the port on which to
bind. The default port number depends on the type of edge.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">path</span></tt>: String</p>
<p>For <tt class="docutils literal"><span class="pre">unix</span></tt> types, this setting defines the file path where the listening
UNIX socket is created. There is no default value.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">backlog</span></tt>: Integer</p>
<p>For <tt class="docutils literal"><span class="pre">tcp</span></tt> and <tt class="docutils literal"><span class="pre">unix</span></tt> types, this setting defines the size of the
backlog of unaccepted connections. See the <a class="reference external" href="http://docs.python.org/library/socket.html#socket.socket.listen" title="(in Python v2.7)"><tt class="xref py py-meth docutils literal"><span class="pre">listen()</span></tt></a>
method for more information. The default is <tt class="docutils literal"><span class="pre">256</span></tt>.</p>
</li>
</ul>
</li>
</ul>
<div class="section" id="smtp-edges">
<h2><tt class="docutils literal"><span class="pre">smtp</span></tt> Edges<a class="headerlink" href="#smtp-edges" title="Permalink to this headline">¶</a></h2>
<p>SMTP Edges produce an <a class="reference internal" href="../api/slimta.edge.smtp.html#slimta.edge.smtp.SmtpEdge" title="slimta.edge.smtp.SmtpEdge"><tt class="xref py py-class docutils literal"><span class="pre">SmtpEdge</span></tt></a> object from the extra keys given in the edge
sub-section. These keys are:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">listener</span></tt>: Dictionary</p>
<p>This mapping defines how to open the listening socket. See the
<a class="reference internal" href="#slimta-listener"><em>listener sub-section</em></a> for information on its
available keys. The default value for <tt class="docutils literal"><span class="pre">port</span></tt> is <tt class="docutils literal"><span class="pre">25</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">hostname</span></tt>: String</p>
<p>This is the string presented as the machine&#8217;s hostname in the SMTP banner
message. By default, this will be the machine&#8217;s FQDN.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">max_size</span></tt>: Integer</p>
<p>This is the maximum allowed size, in bytes, of incoming messages on this SMTP
edge. Larger messages are rejected. By default, there is no size limit.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">tls</span></tt>: Dictionary</p>
<p>This mapping, which takes the same keys as the keyword parameters to
<a class="reference external" href="http://docs.python.org/library/ssl.html#ssl.wrap_socket" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">wrap_socket()</span></tt></a>, both enables and configures TLS encryption on this
SMTP edge. By default, TLS is not enabled.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">tls_immediately</span></tt>: Boolean</p>
<p>Defines whether or not TLS should handshake immediately on connection, or if
a socket is only encrypted if the user runs <tt class="docutils literal"><span class="pre">STARTTLS</span></tt>. By default, sessions
are only encrypted on <tt class="docutils literal"><span class="pre">STARTTLS</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">rules</span></tt>: Dictionary</p>
<p>This sub-section gives extra configurability in the internals of the SMTP
edge. It has its own set of keys, all of which are optional:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">banner</span></tt>: String</p>
<p>This string is presented to connecting clients as the SMTP banner message.
It can contain <tt class="docutils literal"><span class="pre">{fqdn}</span></tt> or <tt class="docutils literal"><span class="pre">{hostname}</span></tt> to substitute in the respective
information about the local machine. By default, a generic banner message is
used.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">dnsbl</span></tt>: String</p>
<p>Specifies a server that will be queried as a DNS blocklist. If a connecting
client &#8220;hits&#8221; on the DNS blocklist, it is rejected outright. By default, no
DNS blocklists are checked.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">reject_spf</span></tt>: List</p>
<p>Specifies a list of SPF result types that are rejected in an SMTP session.
Valid strings in the list are: <tt class="docutils literal"><span class="pre">pass</span></tt>, <tt class="docutils literal"><span class="pre">permerror</span></tt>, <tt class="docutils literal"><span class="pre">fail</span></tt>,
<tt class="docutils literal"><span class="pre">temperror</span></tt>, <tt class="docutils literal"><span class="pre">softfail</span></tt>, <tt class="docutils literal"><span class="pre">none</span></tt>, and <tt class="docutils literal"><span class="pre">neutral</span></tt>. By default, no SPF
results are rejected.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">reject_spam</span></tt>: Dictionary</p>
<p>Specifies a spam engine that will be used to reject message data that is
considered spam before it is accepted for delivery. At the moment, only
<a class="reference internal" href="../api/slimta.policy.spamassassin.html#module-slimta.policy.spamassassin" title="slimta.policy.spamassassin"><tt class="xref py py-mod docutils literal"><span class="pre">spamassassin</span></tt></a> is available, which takes optional
<tt class="docutils literal"><span class="pre">host</span></tt> and <tt class="docutils literal"><span class="pre">port</span></tt> keys.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">only_senders</span></tt>: List</p>
<p>Only the email addresses in this list will be accepted when given in the
<tt class="docutils literal"><span class="pre">MAIL</span> <span class="pre">FROM:&lt;&gt;</span></tt> command from a client. By default, all senders are
accepted.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">only_recipients</span></tt>: List</p>
<p>Only the email addresses in this list will be acceped when given in the
<tt class="docutils literal"><span class="pre">RCPT</span> <span class="pre">TO:&lt;&gt;</span></tt> commands from the client. By default, all recipients are
accepted.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">require_credentials</span></tt>: Dictionary</p>
<p>If this option is given, clients are required to authenticate before mail
can be accepted. The keys and values in this dictionary are the usernames
and passwords, respectively, of the valid authentication credentials.</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="http-edges">
<h2><tt class="docutils literal"><span class="pre">http</span></tt> Edges<a class="headerlink" href="#http-edges" title="Permalink to this headline">¶</a></h2>
<p>HTTP Edges produce an <a class="reference internal" href="../api/slimta.edge.wsgi.html#slimta.edge.wsgi.WsgiEdge" title="slimta.edge.wsgi.WsgiEdge"><tt class="xref py py-class docutils literal"><span class="pre">WsgiEdge</span></tt></a> object that is then
configured to receive mail. It supports the following options:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">listener</span></tt>: Dictionary</p>
<p>This mapping defines how to open the listening socket. See the
<a class="reference internal" href="#slimta-listener"><em>listener sub-section</em></a> for information on its
available keys. The default value for <tt class="docutils literal"><span class="pre">port</span></tt> is <tt class="docutils literal"><span class="pre">8025</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">hostname</span></tt>: String</p>
<p>This is the string presented as the machine&#8217;s hostname in the SMTP banner
message. By default, this will be the machine&#8217;s FQDN.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">uri</span></tt>: String</p>
<p>This option defines a regular expression pattern that request paths must
match, or a <tt class="docutils literal"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></tt> will be returned. If it is not given, all paths
are accepted.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">tls</span></tt>: Dictionary</p>
<p>This mapping, which takes the same keys as the keyword parameters to
<a class="reference external" href="http://docs.python.org/library/ssl.html#ssl.wrap_socket" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">wrap_socket()</span></tt></a>, both enables and configures TLS encryption on this
HTTP edge. All inbound requests must be HTTPS. By default, TLS is not
enabled.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">rules</span></tt>: Dictionary</p>
<p>This sub-section gives extra configurability in the internals of the HTTP
edge. It has its own set of keys, all of which are optional:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">only_senders</span></tt>: List</p>
<p>Only the email addresses in this list will be accepted when given in the
<tt class="docutils literal"><span class="pre">X-Envelope-Sender</span></tt> header from a client. By default, all senders are
accepted.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">only_recipients</span></tt>: List</p>
<p>Only the email addresses in this list will be acceped when given in the
<tt class="docutils literal"><span class="pre">X-Envelope-Recipient</span></tt> headers from the client. By default, all
recipients are accepted.</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="custom-edges">
<h2><tt class="docutils literal"><span class="pre">custom</span></tt> Edges<a class="headerlink" href="#custom-edges" title="Permalink to this headline">¶</a></h2>
<p>Only one additional key is required by the <tt class="docutils literal"><span class="pre">&quot;custom&quot;</span></tt> edge type:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">factory</span></tt>: String, required</p>
<p>This is a string of the form <tt class="docutils literal"><span class="pre">package.module:symbol</span></tt>. The package and
module portion are imported with <a class="reference external" href="http://docs.python.org/library/importlib.html#importlib.import_module" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">importlib.import_module()</span></tt></a>, and then
the symbol is fetched from the loaded module with <a class="reference external" href="http://docs.python.org/library/functions.html#getattr" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">getattr()</span></tt></a>.</p>
<p>The result of loading the symbol must be a function that takes two arguments,
the options object (that contains the <tt class="docutils literal"><span class="pre">type</span></tt>, <tt class="docutils literal"><span class="pre">queue</span></tt>, and <tt class="docutils literal"><span class="pre">factory</span></tt>
keys as well as any others as necessary) and the <a class="reference internal" href="../api/slimta.queue.html#slimta.queue.Queue" title="slimta.queue.Queue"><tt class="xref py py-class docutils literal"><span class="pre">Queue</span></tt></a> object that the edge
should delivery received messages to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">edge_factory</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
    <span class="k">if</span> <span class="s">&#39;foo&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FooEdge</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">stuff</span><span class="p">,</span> <span class="n">queue</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">BarEdge</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">baz</span><span class="p">,</span> <span class="n">queue</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html">
          <img class="logo" src="../_static/slimta.svg" alt="Logo"/>
        </a></p>
  <div class="sphinxlocaltoc">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuring the Edges</a><ul>
<li><a class="reference internal" href="#smtp-edges"><tt class="docutils literal"><span class="pre">smtp</span></tt> Edges</a></li>
<li><a class="reference internal" href="#http-edges"><tt class="docutils literal"><span class="pre">http</span></tt> Edges</a></li>
<li><a class="reference internal" href="#custom-edges"><tt class="docutils literal"><span class="pre">custom</span></tt> Edges</a></li>
</ul>
</li>
</ul>

  </div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="slimta.processes.html"
                        title="previous chapter">Configuring the Processes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="slimta.queues.html"
                        title="next chapter">Configuring the Queues</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.queues.html" title="Configuring the Queues"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.processes.html" title="Configuring the Processes"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">slimta 0.3.15 documentation</a> &raquo;</li>

          <li><a href="../manual.html" >Usage Manual</a> &raquo;</li>
          <li><a href="slimta.html" >Application Usage</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2013, Ian Good.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>