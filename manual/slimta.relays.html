


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Configuring the Relays &#8212; slimta 5.0.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="icon" href="../_static/slimta.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Slimta Blog" href="../blog/index.html" />
    <link rel="prev" title="Configuring the Queues" href="slimta.queues.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../blog/index.html" title="Slimta Blog"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.queues.html" title="Configuring the Queues"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">slimta 5.0.5 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Usage Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="slimta.html" accesskey="U">Application Usage</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Configuring the Relays</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="configuring-the-relays">
<h1>Configuring the Relays<a class="headerlink" href="#configuring-the-relays" title="Permalink to this heading">¶</a></h1>
<p>The last major section in <code class="docutils literal notranslate"><span class="pre">slimta.conf</span></code> is <code class="docutils literal notranslate"><span class="pre">relay</span></code>, where you set up the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Relay</span></code> options for outbound message delivery. In the <code class="docutils literal notranslate"><span class="pre">relay</span></code> section, each
key  provides an arbitrary, free-form name for the relay, and the value is a
mapping with one required key:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: String</p>
<p>Defines the type of relay. A known type must be given or an error will be
thrown. The other keys in this mapping depend on the value of <code class="docutils literal notranslate"><span class="pre">type</span></code>.</p>
</li>
</ul>
<section id="mx-and-static-relays">
<h2><code class="docutils literal notranslate"><span class="pre">mx</span></code> and <code class="docutils literal notranslate"><span class="pre">static</span></code> Relays<a class="headerlink" href="#mx-and-static-relays" title="Permalink to this heading">¶</a></h2>
<p>When configuring an <a class="reference external" href="https://en.wikipedia.org/wiki/Mail_submission_agent">MSA</a>, you generally want to accept all mail from
authorized senders for delivery to the intended target. The fundamental design
of email uses DNS MX records to allow domains to advertize the servers that
will accept mail on its behalf. Other times, you might want to delivery <em>all</em>
mail to a particular host, perhaps for spam or abuse prevention. Using the
<code class="docutils literal notranslate"><span class="pre">&quot;mx&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;static&quot;</span></code> relay types provide this behavior.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">&quot;mx&quot;</span></code> type produces an <code class="xref py py-class docutils literal notranslate"><span class="pre">MxSmtpRelay</span></code>
and the <code class="docutils literal notranslate"><span class="pre">&quot;static&quot;</span></code> type produces a
<code class="xref py py-class docutils literal notranslate"><span class="pre">StaticSmtpRelay</span></code>. Both share several config
options that can customize their behavior:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">connect_timeout</span></code>: Integer</p>
<p>Defines the time, in seconds, that the relay will allow for connection before
failing. The default is 30 seconds.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">command_timeout</span></code>: Integer</p>
<p>Defines the time, in seconds, that the relay will wait for a response to each
SMTP command before failing and disconnecting. The default is 30 seconds.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_timeout</span></code>: Integer</p>
<p>Defines the time, in seconds, that the relay will wait for message data to be
accepted. This delay may be longer than most other commands, as the remote
host will likely need time to spool the message. The default is 60 seconds.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">idle_timeout</span></code>: Integer</p>
<p>Unlike the other timeouts, this is the amount of time an outbound connection
is left open <em>after</em> a message has been delivered. If a new message is to be
delivered to the same host, the connection can be recycled. The default is
10 seconds.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">concurrent_connections</span></code>: Integer</p>
<p>The maximum number of simultaneous connections to any given remote host. If
this limit is reached, delivery of messages to that host will block until a
space is freed. The default is 5 connections.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ehlo_as</span></code>: String</p>
<p>This string is used as the <code class="docutils literal notranslate"><span class="pre">EHLO</span></code>/<code class="docutils literal notranslate"><span class="pre">HELO</span></code> string when handshaking with
remote hosts. This setting should <em>never</em> be an IP address, <code class="docutils literal notranslate"><span class="pre">&quot;localhost&quot;</span></code>,
or <code class="docutils literal notranslate"><span class="pre">&quot;localdomain&quot;</span></code>, as many email services will block these and list your
IP on DNS blocklists. By default, the FQDN of the local machine is used.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">tls</span></code>: Dictionary</p>
<p>This mapping, which takes the same keys as the keyword parameters to
<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.wrap_socket" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">wrap_socket()</span></code></a>, both enables and configures TLS encryption on this
SMTP relay. By default, TLS is not enabled.</p>
</li>
</ul>
<p>There are some additional options that apply <em>only</em> to <code class="docutils literal notranslate"><span class="pre">&quot;static&quot;</span></code> relay
types.  These options specify the permanent delivery address for all mail, and
are as follows:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">host</span></code>: String, required</p>
<p>The host name or IP address of the destination for outbound mail delivery on
the <code class="docutils literal notranslate"><span class="pre">&quot;static&quot;</span></code> relay type.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>: Integer</p>
<p>The port number to connect to on the destination server for outbound mail
delivery on the <code class="docutils literal notranslate"><span class="pre">&quot;static&quot;</span></code> relay type.</p>
</li>
</ul>
</section>
<section id="lmtp-relays">
<h2><code class="docutils literal notranslate"><span class="pre">lmtp</span></code> Relays<a class="headerlink" href="#lmtp-relays" title="Permalink to this heading">¶</a></h2>
<p>This relay type is configured exactly like the <code class="docutils literal notranslate"><span class="pre">static</span></code> relay type, except the
<code class="docutils literal notranslate"><span class="pre">host</span></code> option defaults to <code class="docutils literal notranslate"><span class="pre">&quot;localhost&quot;</span></code>. This option will produce a
<code class="xref py py-class docutils literal notranslate"><span class="pre">StaticLmtpRelay</span></code> object to deliver messages,
such as when configured as an <a class="reference external" href="https://en.wikipedia.org/wiki/Mail_delivery_agent">MDA</a>.</p>
</section>
<section id="pipe-relays">
<h2><code class="docutils literal notranslate"><span class="pre">pipe</span></code> Relays<a class="headerlink" href="#pipe-relays" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;pipe&quot;</span></code> relay type mimcs the postfix <a class="reference external" href="http://www.postfix.org/pipe.8.html">pipe</a> daemon, which is a useful
delivery mechanism for handing off a message to an external process by piping
the message data to the process’s <em>stdin</em> stream. This relay type has the
following configuration keys:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code>: List</p>
<p>These are the arguments for the subprocess, similar to the <code class="docutils literal notranslate"><span class="pre">args</span></code> parameter
to the <a class="reference external" href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Popen</span></code></a> constructor. This list may contain
several macros, see the <code class="xref py py-class docutils literal notranslate"><span class="pre">PipeRelay</span></code> class
constructor for more information.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_pattern</span></code>: String</p>
<p>This string defines a regular expression that parses an error message from
the subprocess’s <em>stdout</em> or <em>stderr</em>, whichever matches.</p>
</li>
</ul>
</section>
<section id="maildrop-relays">
<h2><code class="docutils literal notranslate"><span class="pre">maildrop</span></code> Relays<a class="headerlink" href="#maildrop-relays" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;maildrop&quot;</span></code> relay type enables message delivery to the local machine,
using the <a class="reference external" href="http://www.courier-mta.org/maildrop/">courier maildrop</a> application. The behavior of this relay is mostly
configured externally using <code class="docutils literal notranslate"><span class="pre">.mailfilter</span></code> files, though it allows for one
configuration key:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: String</p>
<p>The path to the <code class="docutils literal notranslate"><span class="pre">maildrop</span></code> executable. By default, the <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>
environment variable is searched.</p>
</li>
</ul>
</section>
<section id="dovecot-relays">
<h2><code class="docutils literal notranslate"><span class="pre">dovecot</span></code> Relays<a class="headerlink" href="#dovecot-relays" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;dovecot&quot;</span></code> relay type enables message delivery to the local machine,
using the <a class="reference external" href="http://wiki.dovecot.org/LDA">LDA</a> agent included with <a class="reference external" href="http://www.dovecot.org/">dovecot</a>. The behavior of this relay is
mostly configured within dovecot using Sieve or similar, though it allows for
one configuration key:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: String</p>
<p>The path to the <code class="docutils literal notranslate"><span class="pre">dovecot-lda</span></code> executable. By default, the <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>
environment variable is searched.</p>
</li>
</ul>
</section>
<section id="http-relays">
<h2><code class="docutils literal notranslate"><span class="pre">http</span></code> Relays<a class="headerlink" href="#http-relays" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;http&quot;</span></code> relay type uses request headers to specify the information
about the session and envelope normally given in SMTP commands, and the
response code and headers to determine whether delivery was successful, or if
it permanently or transiently failed.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code>: String</p>
<p>The URL string to POST messages to. This string determines the hostname,
port, and path for the request. The <code class="docutils literal notranslate"><span class="pre">http:</span></code> or <code class="docutils literal notranslate"><span class="pre">https:</span></code> scheme is ignored
in favor of the <code class="docutils literal notranslate"><span class="pre">tls</span></code> option below.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ehlo_as</span></code>: String</p>
<p>Optional string passed as the <code class="docutils literal notranslate"><span class="pre">X-Ehlo</span></code> header in the request. If not given,
the system FQDN is used.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code>: Number</p>
<p>Timeout in seconds for the entire request and response, including connection
time, before the delivery attempt transiently fails. Default is 60 seconds.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">idle_timeout</span></code>: Number</p>
<p>If given, connections are left open after a response is received, and another
delivery is attempted before this timeout, the connection is recycled. By
default, connections are closed immediately.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">tls</span></code>: Dictionary</p>
<p>This mapping, which takes the same keys as the keyword parameters to
<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.wrap_socket" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">wrap_socket()</span></code></a>, both enables and configures TLS encryption on this
HTTP relay. This means the server must be configured for HTTPS. By default,
TLS is not enabled.</p>
</li>
</ul>
</section>
<section id="blackhole-relays">
<h2><code class="docutils literal notranslate"><span class="pre">blackhole</span></code> Relays<a class="headerlink" href="#blackhole-relays" title="Permalink to this heading">¶</a></h2>
<p>This relay type considers every message delivered to it a successful delivery,
but will take no actual action. This is really only useful for testing. No
additional options are associated with this relay type.</p>
</section>
<section id="custom-relays">
<h2><code class="docutils literal notranslate"><span class="pre">custom</span></code> Relays<a class="headerlink" href="#custom-relays" title="Permalink to this heading">¶</a></h2>
<p>Only one additional key is required by the <code class="docutils literal notranslate"><span class="pre">&quot;custom&quot;</span></code> relay type:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">factory</span></code>: String, required</p>
<p>This is a string of the form <code class="docutils literal notranslate"><span class="pre">package.module:symbol</span></code>. The package and
module portion are imported with <a class="reference external" href="https://docs.python.org/3/library/importlib.html#importlib.import_module" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.import_module()</span></code></a>, and then
the symbol is fetched from the loaded module with <a class="reference external" href="https://docs.python.org/3/library/functions.html#getattr" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">getattr()</span></code></a>.</p>
<p>The result of loading the symbol must be a function that takes one argument,
the options object (that contains the <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">factory</span></code> keys as well
as any others as necessary):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">relay_factory</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;foo&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FooRelay</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">stuff</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">BarRelay</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">baz</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Configuring the Relays</a><ul>
<li><a class="reference internal" href="#mx-and-static-relays"><code class="docutils literal notranslate"><span class="pre">mx</span></code> and <code class="docutils literal notranslate"><span class="pre">static</span></code> Relays</a></li>
<li><a class="reference internal" href="#lmtp-relays"><code class="docutils literal notranslate"><span class="pre">lmtp</span></code> Relays</a></li>
<li><a class="reference internal" href="#pipe-relays"><code class="docutils literal notranslate"><span class="pre">pipe</span></code> Relays</a></li>
<li><a class="reference internal" href="#maildrop-relays"><code class="docutils literal notranslate"><span class="pre">maildrop</span></code> Relays</a></li>
<li><a class="reference internal" href="#dovecot-relays"><code class="docutils literal notranslate"><span class="pre">dovecot</span></code> Relays</a></li>
<li><a class="reference internal" href="#http-relays"><code class="docutils literal notranslate"><span class="pre">http</span></code> Relays</a></li>
<li><a class="reference internal" href="#blackhole-relays"><code class="docutils literal notranslate"><span class="pre">blackhole</span></code> Relays</a></li>
<li><a class="reference internal" href="#custom-relays"><code class="docutils literal notranslate"><span class="pre">custom</span></code> Relays</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="slimta.queues.html"
                          title="Previous page">&larr; Configuring the Queues</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="../blog/index.html"
                          title="Next page">&rarr; Slimta Blog</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../blog/index.html" title="Slimta Blog"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.queues.html" title="Configuring the Queues"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">slimta 5.0.5 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Usage Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="slimta.html" >Application Usage</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Configuring the Relays</a></li> 
      </ul>
    </div>
    </div>


    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Ian Good.
    </div>
    <!-- cloud_sptheme 1.4 -->
<script type="text/javascript">
  document._EUGO = 'ff80897801813c8394e7';
  document.head.appendChild(function() {
    var s = document.createElement('script');
    s.src = 'https://eugo.io/eugo.js';
    s.async = 1;
    return s;
  }());
</script>

  </body>
</html>